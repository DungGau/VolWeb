{% extends "dashboard/base.html" %}
{% load static %}
{% block content%}

<style>
  .main {
      color:#ffffff;
      --tw-bg-opacity: 1;
      font-family: Anonymous Pro, monospace;
      --tw-text-opacity: 1;
      color: rgba(233, 233, 233, var(--tw-text-opacity));
      -moz-osx-font-smoothing: grayscale;
      -moz-osx-font-smoothing: auto;
      font-size: 0.9rem;
  }

  .modal-content {
    background-color: #293b58;
  }

  .table,.btn {
    --tw-bg-opacity: 1;
    font-family: Anonymous Pro, monospace;
    --tw-text-opacity: 1;
    color: rgba(233, 233, 233, var(--tw-text-opacity));
    -moz-osx-font-smoothing: grayscale;
    -moz-osx-font-smoothing: auto;
    font-size: 0.9rem;
  }
  .table tbody tr.highlight td {
    background-color: #a6202a;
  }

  .h3{
    color:#eb1f5a;
  }
  .card-font, .accordion-button, .accordion-item {
    background-color:#1c2a34;
    color: white;
  }

  .accordion-button.collapsed::after {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
  }

  .card-font-2{
    background-color:#293b58;

  }
.hidden {
  visibility:"hidden";
}
  code{
    display: block;
    background: none;
    white-space: pre;
    -webkit-overflow-scrolling: touch;
    overflow-x: scroll;
    max-width: 100%;
    min-width: 100px;
    padding: 0;
    color:white;
  }
</style>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-base.min.js" type="text/javascript"></script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-graph.min.js"></script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-sunburst.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/releases/8.11.0/css/anychart-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/releases/8.11.0/fonts/css/anychart-font.min.css"/>
<div class="container-fluid main" style="overflow-y:scroll;" id="main">

  <!-- Investigation Banner -->

  {% include "investigations/invest_banner.html" %}

  <div class="row mt-3">
    <div class="col-12 card-font">
      <div class="spinner-border text-white" role="status" id="loading"></div>
      <ul class="list-group card-font list-group-flush">

        <!-- Process Artifacts -->

        <li class="list-group-item card-font">
          <h4 class="h5">Process Artifacts</h4>

          {% include "investigations/process_artifacts/process_graph.html" %}

          {% include "investigations/process_artifacts/process_scan.html" %}

          {% include "investigations/process_artifacts/process_tree.html" %}

          {% include "investigations/process_artifacts/process_cmdline.html" %}

          {% include "investigations/process_artifacts/process_privileges.html" %}

          {% include "investigations/process_artifacts/process_env.html" %}
        </li>


        <!-- Network Artifacts -->
        <li class="list-group-item card-font">
          <h5 class="h5">Network Artifacts</h5>
          {% include "investigations/network_artifacts/network_scan.html" %}
          {% include "investigations/network_artifacts/network_graph.html" %}
        </li>


        <!-- Cryptography Artifacts -->
        <li class="list-group-item card-font">
          <h5 class="h5">Cryptography</h5>
          {% include "investigations/crypto_artifacts/crypto_hashdump.html" %}
        </li>

        <!-- Malware Analysis -->

        <li class="list-group-item card-font">
          <h5 class="h5">Malware Analysis (Beta)</h5>
          {% include "investigations/ma_artifacts/ma_timeline.html" %}
          {% include "investigations/ma_artifacts/ma_iocs.html" %}
          {% include "investigations/ma_artifacts/ma_malfind.html" %}
          {% include "investigations/ma_artifacts/ma_filescan.html" %}
          {% include "investigations/ma_artifacts/ma_dumpprocess.html" %}
        </li>

      </div>
    </div>

    <li class="list-group-item card-font">
      <h5 class="h5">Reporting (Beta)</h5>
      <button onclick="GenerateReport('{{case.title}}','{{case.os_version}}','{{case.description}}','{{case.name}}');" class="btn btn-warn-d" type="button">Generate Report <span class='text-muted'>(PDF)</span></button>
    </li>

  </div>
  <!-- Toasts -->
  {% if messages %}
  <div aria-live="polite" aria-atomic="true" style="position: relative;">
    <!-- Position it -->
    <div style="position: absolute; top: 3rem; right: 0;">
      <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <strong class="mr-auto">VolWeb</strong>
        </div>
        <div class="toast-body">
          {% for message in messages %}
          {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
          {{message}}
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}



  <table hidden id="report_table_process_scan"></table>
  <table hidden id="report_table_process_cmdline"></table>
  <table hidden id="report_table_process_priv"></table>
  <table hidden id="report_table_process_env"></table>
  <table hidden id="report_table_process_net"></table>
  <table hidden id="report_table_timeline"></table>
  <table hidden id="report_table_hashdump"></table>
  <table hidden id="report_table_filescan"></table>
  <table hidden id="report_table_processtree"></table>


  <table hidden id="report_table_ioc"></table>
  <script
			  src="https://code.jquery.com/jquery-3.6.0.min.js"
			  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
			  crossorigin="anonymous"></script>
  <script type="module" src="https://unpkg.com/jspdf@2.0.0/dist/jspdf.umd.min.js"></script>
  <script type="module" src="{% static 'dashboard/jspdf.plugin.autotable.js'%}"></script>
  <script src="{% static 'dashboard/report.js'%}"></script>
  <script>
    $('#processTreeTable').on('click', 'tbody tr', function(event) {
      var table = $(this);

      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#processScanTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#processEnvTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#processCmdTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#processPrivilegesTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });


    $('#processNetworkTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });


    $('#TimelineTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });


    $('#FileScanTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#IOCTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });

    $('#processHashTable').on('click', 'tbody tr', function(event) {
      var table = $(this);
      if (table.hasClass("highlight")){
        table.removeClass("highlight");
      }
      else{
        table.addClass("highlight");
      }
    });
    //Binding Case Id for ProcessDump
    $(document).ready(function(){
      $('#main').show();
      $('#loading').hide();
      const case_id = document.getElementById('case_id');
      var id = document.getElementById('id_id');
      id.value = case_id.value;
    });

    //Process Scan Search function
    $(document).ready(function(){
      $("#searchProcess").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#process tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });

      $("#searchMalfind").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#malfind-btn button").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });

      //TimeLine SearchBar
      $("#searchTimeline").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#TimelineTab tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) !== -1)
        })
      });

      //CmdLine SearchBar

      $("#searchCmdLine").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#cmdline tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });

      //Network SearchBar

      $("#searchNetwork").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#network tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });


      //ProcessScan SearchBar

      $("#searchProcessScan").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#processScan tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });



      //Process Privileges SearchBar

      $("#searchPriv").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#processPriv tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });


      //Process Env SearchBar

      $("#searchEnv").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#processEnv tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });


      //FileScan SearchBar

      $("#searchFileScan").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#FileScanTab tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });


      //IOC SearchBar

      $("#searchIOC").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#IOCTab tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });
    });

    $(document).ready(function(){
      $('.toast').toast('show');
    });
  </script>
  {% endblock content %}
